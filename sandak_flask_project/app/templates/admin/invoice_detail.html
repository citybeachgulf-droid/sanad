{% extends 'layout.html' %}
{% block title %}فاتورة #{{ inv.id }}{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h5 class="mb-0">فاتورة #{{ inv.id }}</h5>
  <a class="btn btn-outline-secondary" href="{{ url_for('main.invoices_list') }}">رجوع</a>
</div>

<div class="row g-3">
  <div class="col-lg-6">
    <div class="card shadow-sm">
      <div class="card-header bg-white">تفاصيل</div>
      <div class="card-body">
        <div class="mb-2"><strong>العميل:</strong> {{ inv.client.name if inv.client else '-' }}</div>
        <div class="mb-2"><strong>الحالة:</strong> <span class="badge {% if inv.status=='paid' %}bg-success{% elif inv.status=='partial' %}bg-warning text-dark{% elif inv.status=='overdue' %}bg-danger{% else %}bg-secondary{% endif %}">{{ inv.status }}</span></div>
        <div class="mb-2"><strong>الإجمالي:</strong> {{ '%.2f' % inv.total_amount }}</div>
        <div class="mb-2"><strong>تاريخ الاستحقاق:</strong> {{ inv.due_date.strftime('%Y-%m-%d') if inv.due_date else '-' }}</div>
        <div class="mb-2"><strong>ملاحظات:</strong> {{ inv.notes or '-' }}</div>
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="card shadow-sm">
      <div class="card-header bg-white d-flex justify-content-between align-items-center">
        <span>المدفوعات</span>
        <form class="d-flex gap-2" method="post" action="{{ url_for('main.invoice_add_payment', invoice_id=inv.id) }}">
          <input type="number" step="0.01" min="0" class="form-control form-control-sm" name="amount" placeholder="المبلغ" required>
          <input class="form-control form-control-sm" name="method" placeholder="الطريقة (نقد/تحويل/...)" >
          <input class="form-control form-control-sm" name="reference" placeholder="مرجع" >
          <button class="btn btn-sm btn-primary" type="submit">إضافة دفعة</button>
        </form>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-sm align-middle mb-0">
            <thead class="table-light"><tr><th>المبلغ</th><th>الطريقة</th><th>المرجع</th><th>التاريخ</th></tr></thead>
            <tbody>
              {% for p in payments %}
              <tr>
                <td>{{ '%.2f' % p.amount }}</td>
                <td>{{ p.method or '-' }}</td>
                <td>{{ p.reference or '-' }}</td>
                <td class="text-muted small">{{ p.paid_at.strftime('%Y-%m-%d %H:%M') }}</td>
              </tr>
              {% else %}
              <tr><td colspan="4" class="text-center text-muted">لا توجد مدفوعات</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

