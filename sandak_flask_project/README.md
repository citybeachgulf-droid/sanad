# نظام إدارة مكاتب سند — مشروع بايثون + فلاسک (Starter)

محتويات:
- app/__init__.py   -> تهيئة التطبيق وملحقاته
- app/models.py     -> نماذج قاعدة البيانات (SQLAlchemy)
- app/forms.py      -> WTForms للنماذج الأساسية
- app/routes.py     -> مسارات Flask (Blueprints)
- app/auth.py       -> مصادقة المستخدمين (login/logout)
- app/templates/    -> قالب Jinja بسيط (index.html, login.html, dashboard.html)
- config.py         -> إعدادات التطبيق
- run.py            -> نقطة الدخول
- requirements.txt  -> الحزم المطلوبة

تشغيل محلي سريع:
1. python -m venv venv
2. source venv/bin/activate  # أو venv\Scripts\activate على ويندوز
3. pip install -r requirements.txt
4. export FLASK_APP=run.py  (او set FLASK_APP=run.py على ويندوز)
5. flask db init; flask db migrate -m "init"; flask db upgrade
6. flask run

اختبارات سريعة يدوية:
- تسجيل الدخول كمشرف/موظف.
- إنشاء عميل ثم افتح صفحة تفاصيله وأضف وسيلة تواصل وملاحظة.
- إنشاء معاملة وربطها بموظف وتحديد موعد نهائي؛ عدل حالتها وسجل سبب التأخير عند اللزوم.
- افتح الفواتير وأنشئ فاتورة وأضف دفعة جزئية وتحقق من تغيير حالة الفاتورة.
- اعرض التقارير المخصصة وصفِ النتائج؛ جرّب إرسال تنبيهات القريب من الموعد (سيطبع في السجل).

قاعدة بيانات افتراضية: SQLite (config.py). لتغيير إلى PostgreSQL غيّر URI في config.py

\nميزات مضافة:
- لوحة معاملات محسّنة: حالات جديدة/تحت الإجراء/منتهية/متأخرة، فلترة حسب الموظف ونوع الخدمة، تسجيل سبب التأخير، تنبيهات للقريب من الموعد.
- إدارة العملاء: عدة وسائل تواصل، ملاحظات، صفحة تفاصيل مع تاريخ معاملات قابل للتصفية.
- المهام: إنشاء وتحديث مهام مرتبطة بالعميل/المعاملة مع حالة وأولوية ومهلة.
- الفواتير: إنشاء فاتورة، دفعات جزئية، حالة فاتورة ديناميكية، صفحات قائمة وتفاصيل.
- تقارير: ملخص مالي يومي/أسبوعي/شهري وفواتير متأخرة، تقارير مخصصة حسب الموظف/العميل/الفترة.
- تنبيهات: إرسال تنبيهات (نموذج أولي) عبر البريد/واتساب للمعاملات القريبة من الموعد.
- واجهة مستخدم: تحسينات في القوالب والألوان والشارات وإضافة روابط للفواتير والتقارير.

\nالنسخ الاحتياطي المقترح:
- استخدم مهمة مجدولة cron لأخذ نسخة SQLite يومية.
- مثال أمر:
  - Linux: `sqlite3 sandak.db ".backup 'backups/sandak_$(date +%F).db'"`
- احتفظ بآخر 30 نسخة واحذف الأقدم تلقائياً.
- للتبديل إلى PostgreSQL: استخدم pg_dump يومي، وخزن الملفات في تخزين خارجي آمن.
